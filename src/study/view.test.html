<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Study Lenses Main Component Test</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .test-section {
        margin: 20px 0;
        padding: 20px;
        border: 2px solid #ddd;
        border-radius: 8px;
        background: white;
      }
      .test-section.pass {
        border-color: #28a745;
        background: #f8fff9;
      }
      .test-section.fail {
        border-color: #dc3545;
        background: #fff8f8;
      }
      pre {
        background: #f5f5f5;
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
      }
      .checklist {
        margin: 10px 0;
        background: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
      }
      .checklist li {
        margin: 5px 0;
      }
      .expected {
        color: #666;
        font-style: italic;
        background: #e9ecef;
        padding: 8px;
        border-radius: 4px;
        margin: 10px 0;
      }
      h1 {
        color: #007acc;
      }
      h2 {
        color: #333;
        margin-top: 0;
      }
      .pipeline-output {
        border: 2px solid #28a745;
        margin: 10px 0;
        border-radius: 4px;
        padding: 10px;
        background: #f8fff9;
      }
      .panel-output {
        border: 2px solid #17a2b8;
        margin: 10px 0;
        border-radius: 4px;
        padding: 10px;
        background: #f0f9ff;
      }
      .mode-indicator {
        font-weight: bold;
        color: #007acc;
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <h1>üß™ Study Lenses Main Component Test</h1>
    <p>
      Testing the main study-lenses component that orchestrates both pipeline and study panel modes.
    </p>

    <!-- Test 1: Pipeline mode basics -->
    <div class="test-section">
      <h2>Test 1: Basic Pipeline Mode</h2>
      <div class="expected">
        <strong>Expected:</strong> Should process lenses sequentially: "hello world" ‚Üí reverse ‚Üí
        uppercase ‚Üí "DLROW OLLEH"
      </div>

      <div class="pipeline-output">
        <div class="mode-indicator">üîó Pipeline Mode (Space-separated)</div>
        <study-lenses lenses="reverse uppercase" code="hello world"></study-lenses>
      </div>

      <div class="pipeline-output">
        <div class="mode-indicator">üîó Pipeline Mode (Comma-separated)</div>
        <study-lenses lenses="reverse, uppercase, lowercase" code="HELLO WORLD"></study-lenses>
      </div>

      <div class="checklist">
        <strong>Manual Verification Checklist:</strong>
        <ul>
          <li>‚òê First pipeline shows "DLROW OLLEH"</li>
          <li>‚òê Second pipeline shows "dlrow olleh" (reverse ‚Üí upper ‚Üí lower)</li>
          <li>‚òê Both space and comma separation work</li>
          <li>‚òê No console errors during processing</li>
          <li>‚òê Pipeline processes sequentially, not in parallel</li>
        </ul>
      </div>
    </div>

    <!-- Test 2: Study panel mode -->
    <div class="test-section">
      <h2>Test 2: Study Panel Mode (Parallel Views)</h2>
      <div class="expected">
        <strong>Expected:</strong> Should distribute same code to all child lenses for parallel
        processing
      </div>

      <div class="panel-output">
        <div class="mode-indicator">üìä Study Panel Mode</div>
        <study-lenses code="function greet(name) { return `Hello, ${name}!`; }">
          <sl-lens-reverse></sl-lens-reverse>
          <sl-lens-uppercase></sl-lens-uppercase>
          <sl-lens-lowercase></sl-lens-lowercase>
        </study-lenses>
      </div>

      <div class="checklist">
        <strong>Manual Verification Checklist:</strong>
        <ul>
          <li>‚òê All three lenses show different transformations of same code</li>
          <li>‚òê Reverse lens shows function reversed</li>
          <li>‚òê Uppercase lens shows function in ALL CAPS</li>
          <li>‚òê Lowercase lens shows function in lowercase</li>
          <li>‚òê Original code is preserved for each lens</li>
          <li>‚òê No interference between parallel lenses</li>
        </ul>
      </div>
    </div>

    <!-- Test 3: Code discovery precedence -->
    <div class="test-section">
      <h2>Test 3: Code Discovery Hierarchy</h2>
      <div class="expected">
        <strong>Expected:</strong> Should follow code discovery precedence: element code ‚Üí
        textContent ‚Üí child snippet
      </div>

      <h3>Element Code Attribute (Highest Priority):</h3>
      <div class="pipeline-output">
        <study-lenses lenses="reverse" code="from attribute">from textContent</study-lenses>
      </div>

      <h3>TextContent (Middle Priority):</h3>
      <div class="pipeline-output">
        <study-lenses lenses="reverse">from textContent</study-lenses>
      </div>

      <h3>Child Snippet (Lower Priority):</h3>
      <div class="panel-output">
        <study-lenses>
          <sl-snippet code="from child snippet"></sl-snippet>
          <sl-lens-reverse></sl-lens-reverse>
        </study-lenses>
      </div>

      <div class="checklist">
        <strong>Manual Verification Checklist:</strong>
        <ul>
          <li>‚òê First test shows "etubirtta morf" (attribute wins over textContent)</li>
          <li>‚òê Second test shows "tnetnoCtxet morf" (uses textContent)</li>
          <li>‚òê Third test shows "teppins dlihc morf" (uses child snippet)</li>
          <li>‚òê Precedence hierarchy is correctly followed</li>
        </ul>
      </div>
    </div>

    <!-- Test 4: File loading -->
    <div class="test-section">
      <h2>Test 4: File Path Loading</h2>
      <div class="expected">
        <strong>Expected:</strong> Should load code from files and auto-detect language/test flags
      </div>

      <h3>JavaScript File:</h3>
      <div class="pipeline-output">
        <study-lenses lenses="reverse" code="../examples/content/greet.js"></study-lenses>
      </div>

      <h3>Test File (should detect test: true):</h3>
      <div class="pipeline-output">
        <study-lenses lenses="uppercase" code="../examples/content/math.test.js"></study-lenses>
      </div>

      <div class="checklist">
        <strong>Manual Verification Checklist:</strong>
        <ul>
          <li>‚òê JavaScript file loads and processes correctly</li>
          <li>‚òê Test file loads with appropriate handling</li>
          <li>‚òê Language auto-detection works (.js ‚Üí lang: 'js')</li>
          <li>‚òê Test flag auto-detection works (.test.js ‚Üí test: true)</li>
          <li>‚òê Error handling for missing files is graceful</li>
        </ul>
      </div>
    </div>

    <!-- Test 5: JSX lens integration -->
    <div class="test-section">
      <h2>Test 5: JSX Lens Integration (Visual Output)</h2>
      <div class="expected">
        <strong>Expected:</strong> Should render JSX components inline and terminate pipeline
        appropriately
      </div>

      <h3>JSX in Study Panel:</h3>
      <div class="panel-output">
        <study-lenses code="const fibonacci = n => n <= 1 ? n : fibonacci(n-1) + fibonacci(n-2);">
          <sl-lens-jsx-demo></sl-lens-jsx-demo>
          <sl-lens-reverse></sl-lens-reverse>
        </study-lenses>
      </div>

      <h3>JSX in Pipeline (should terminate):</h3>
      <div class="pipeline-output">
        <study-lenses
          lenses="reverse jsx-demo uppercase"
          code="function test() { return 42; }"
        ></study-lenses>
      </div>

      <div class="checklist">
        <strong>Manual Verification Checklist:</strong>
        <ul>
          <li>‚òê JSX component renders correctly in study panel</li>
          <li>‚òê Other lenses also process the same code in parallel</li>
          <li>‚òê Pipeline with JSX terminates at JSX (no uppercase applied)</li>
          <li>‚òê JSX analysis dashboard is interactive and functional</li>
          <li>‚òê No conflicts between JSX and regular lenses</li>
        </ul>
      </div>
    </div>

    <!-- Test 6: Error handling -->
    <div class="test-section">
      <h2>Test 6: Error Handling and Edge Cases</h2>
      <div class="expected">
        <strong>Expected:</strong> Should handle errors gracefully without breaking the page
      </div>

      <h3>Invalid Lens Name:</h3>
      <div class="pipeline-output">
        <study-lenses lenses="nonexistent-lens reverse" code="test error handling"></study-lenses>
      </div>

      <h3>Empty Code:</h3>
      <div class="pipeline-output">
        <study-lenses lenses="reverse uppercase" code=""></study-lenses>
      </div>

      <h3>Missing Code Attribute and Content:</h3>
      <div class="panel-output">
        <study-lenses>
          <sl-lens-reverse></sl-lens-reverse>
        </study-lenses>
      </div>

      <div class="checklist">
        <strong>Manual Verification Checklist:</strong>
        <ul>
          <li>‚òê Invalid lens name produces warning but doesn't crash</li>
          <li>‚òê Valid lenses still process despite invalid ones</li>
          <li>‚òê Empty code is handled without errors</li>
          <li>‚òê Missing code shows appropriate warning or default behavior</li>
          <li>‚òê Error messages are helpful and user-friendly</li>
          <li>‚òê Page remains functional after errors</li>
        </ul>
      </div>
    </div>

    <!-- Test 7: Nested and complex scenarios -->
    <div class="test-section">
      <h2>Test 7: Complex Nesting and Integration</h2>
      <div class="expected">
        <strong>Expected:</strong> Should handle complex nesting scenarios correctly
      </div>

      <h3>Study Panel with Mixed Content:</h3>
      <div class="panel-output">
        <study-lenses
          code="// Complex example
class Calculator {
  add(a, b) { return a + b; }
  multiply(a, b) { return a * b; }
}
const calc = new Calculator();
console.log(calc.add(5, calc.multiply(2, 3)));
"
        >
          <sl-lens-jsx-demo></sl-lens-jsx-demo>
          <sl-lens-reverse></sl-lens-reverse>
          <sl-lens-uppercase></sl-lens-uppercase>
        </study-lenses>
      </div>

      <h3>Long Pipeline:</h3>
      <div class="pipeline-output">
        <study-lenses
          lenses="reverse, uppercase, lowercase, reverse"
          code="transform chain test"
        ></study-lenses>
      </div>

      <div class="checklist">
        <strong>Manual Verification Checklist:</strong>
        <ul>
          <li>‚òê Complex code is distributed correctly to all lenses</li>
          <li>‚òê JSX analysis shows accurate statistics for complex code</li>
          <li>‚òê Long pipeline processes all transformations correctly</li>
          <li>‚òê Performance remains acceptable with multiple lenses</li>
          <li>‚òê Visual layout handles multiple outputs well</li>
        </ul>
      </div>
    </div>

    <!-- Test 8: Configuration and attributes -->
    <div class="test-section">
      <h2>Test 8: Configuration and Attributes</h2>
      <div class="expected">
        <strong>Expected:</strong> Should pass configuration correctly to lens functions
      </div>

      <h3>Language Specification:</h3>
      <div class="pipeline-output">
        <study-lenses lenses="reverse" code="test" lang="python"></study-lenses>
      </div>

      <h3>Test Flag:</h3>
      <div class="pipeline-output">
        <study-lenses lenses="uppercase" code="describe('test', () => {})" test></study-lenses>
      </div>

      <div class="checklist">
        <strong>Manual Verification Checklist:</strong>
        <ul>
          <li>‚òê Language attribute is passed to lenses correctly</li>
          <li>‚òê Test flag is handled appropriately</li>
          <li>‚òê Additional attributes don't break functionality</li>
          <li>‚òê Configuration parsing works as expected</li>
        </ul>
      </div>
    </div>

    <!-- Import and register components -->
    <script type="module">
      // Register all components needed for comprehensive testing
      import './register.js';
      import '../../snippet/register.js';
      import '../../lenses/reverse/register.js';
      import '../../lenses/uppercase/register.js';
      import '../../lenses/lowercase/register.js';
      import '../../lenses/jsx-demo/register.js';

      console.log('‚úÖ Study Lenses main component test loaded successfully');

      // Add interactive testing helpers
      window.testStudyLenses = {
        // Test pipeline functionality directly
        async testPipeline(code, lensNames) {
          const { setupPipelineMode } = await import('../web-components/setup-functions.js');

          // Create test element
          const testElement = document.createElement('div');
          testElement.setAttribute('code', code);
          testElement.setAttribute('lang', 'js');

          try {
            await setupPipelineMode(testElement, lensNames);
            console.log('Pipeline test result:', testElement.innerHTML);
            return testElement;
          } catch (error) {
            console.error('Pipeline test failed:', error);
            throw error;
          }
        },

        // Test study panel functionality
        async testStudyPanel(code) {
          const { setupStudyPanelMode } = await import('../web-components/setup-functions.js');

          // Create test element
          const testElement = document.createElement('div');
          testElement.textContent = code;

          try {
            await setupStudyPanelMode(testElement);
            console.log('Study panel test completed');
            return testElement;
          } catch (error) {
            console.error('Study panel test failed:', error);
            throw error;
          }
        },
      };

      // Comprehensive validation after page load
      document.addEventListener('DOMContentLoaded', () => {
        console.log('üîç Performing comprehensive study-lenses validation...');

        setTimeout(() => {
          // Count different types of study-lenses components
          const studyElements = document.querySelectorAll('study-lenses');
          const pipelineElements = document.querySelectorAll('study-lenses[lenses]');
          const panelElements = document.querySelectorAll('study-lenses:not([lenses])');

          console.log(`Found ${studyElements.length} total study-lenses components`);
          console.log(`- ${pipelineElements.length} in pipeline mode`);
          console.log(`- ${panelElements.length} in study panel mode`);

          // Validate that components have processed content
          let hasProcessedContent = true;
          studyElements.forEach((el, i) => {
            const hasContent = el.textContent.trim().length > 0;
            const hasChildContent = el.children.length > 0;

            if (!hasContent && !hasChildContent) {
              console.warn(`‚ö†Ô∏è  Study component ${i + 1} appears to have no content`);
              hasProcessedContent = false;
            }
          });

          if (hasProcessedContent) {
            console.log('‚úÖ All study-lenses components appear to be processing correctly');
          } else {
            console.log('‚ùå Some study-lenses components may not be working correctly');
          }

          // Test a simple pipeline programmatically
          console.log('üß™ Testing pipeline functionality...');
          window.testStudyLenses
            .testPipeline('hello test', ['reverse', 'uppercase'])
            .then(() => {
              console.log('‚úÖ Programmatic pipeline test passed');
            })
            .catch((err) => {
              console.error('‚ùå Programmatic pipeline test failed:', err);
            });
        }, 3000); // Wait longer for all components to initialize
      });
    </script>
  </body>
</html>
